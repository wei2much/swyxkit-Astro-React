---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import { SITE_TITLE, SITE_DESCRIPTION, SITE_URL, DEFAULT_OG_IMAGE, MY_TWITTER_HANDLE } from '../lib/siteConfig';

// Get all blog posts
const allPosts = await getCollection('blog');
const featuredPosts = allPosts.filter(post => post.data.featured).slice(0, 3);
const latestPosts = allPosts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 5);
---

<Layout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <Fragment slot="head">
    <link rel="canonical" href={SITE_URL} />
    <link rel="alternate" type="application/rss+xml" href={`${SITE_URL}/rss.xml`} />
    <meta property="og:url" content={SITE_URL} />
    <meta property="og:type" content="article" />
    <meta property="og:title" content={SITE_TITLE} />
    <meta name="Description" content={SITE_DESCRIPTION} />
    <meta property="og:description" content={SITE_DESCRIPTION} />
    <meta property="og:image" content={DEFAULT_OG_IMAGE} />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:creator" content={`@${MY_TWITTER_HANDLE}`} />
    <meta name="twitter:title" content={SITE_TITLE} />
    <meta name="twitter:description" content={SITE_DESCRIPTION} />
    <meta name="twitter:image" content={DEFAULT_OG_IMAGE} />
  </Fragment>

  <div class="flex flex-col items-start justify-center max-w-2xl px-4 pb-16 mx-auto border-gray-200 dark:border-gray-700 sm:px-8">
    <div class="flex flex-col-reverse items-start sm:flex-row">
      <div class="flex flex-col pr-8">
        <h1 class="mb-3 text-3xl font-bold tracking-tight text-black dark:text-white md:text-5xl">
          This is
          <span class="relative inline-block ml-2 before:absolute before:-inset-1 before:block before:-skew-y-3 before:bg-red-500">
            <span class="relative text-yellow-400 skew-y-3">{SITE_TITLE}</span>
          </span>
          !
        </h1>
        <h2 class="mb-4 text-gray-700 dark:text-gray-200">
          An opinionated blog starter for <span class="font-semibold">Astro + React + Tailwind + Netlify/Vercel.</span>
          Updated for Astro v5!
        </h2>
        <p class="mb-16 text-gray-600 dark:text-gray-400">
          Ported from the original SvelteKit version with complete feature parity!
        </p>
      </div>
    </div>

    <section class="w-full mb-16">
      <h3 class="mb-6 text-2xl font-bold tracking-tight text-black dark:text-white md:text-4xl">
        Featured Posts
      </h3>
      <div class="flex flex-col gap-6 md:flex-row">
        {featuredPosts.map(post => (
          <a 
            href={`/blog/${post.slug}`}
            class="flex flex-col p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow"
          >
            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
              {post.data.title}
            </h4>
            <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">
              {post.data.date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short' 
              })}
            </p>
            <p class="text-gray-700 dark:text-gray-300 text-sm">
              {post.data.description}
            </p>
          </a>
        ))}
      </div>
    </section>

    <section class="w-full mb-16">
      <h3 class="mb-6 text-2xl font-bold tracking-tight text-black dark:text-white md:text-4xl">
        Latest Posts
      </h3>
      <div class="space-y-4">
        {latestPosts.map(post => (
          <article class="border-b border-gray-200 dark:border-gray-700 pb-4">
            <a href={`/blog/${post.slug}`} class="block hover:bg-gray-50 dark:hover:bg-gray-800 rounded p-4 -m-4 transition-colors">
              <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-1">
                {post.data.title}
              </h4>
              <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">
                {post.data.date.toLocaleDateString('en-US', { 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric' 
                })}
              </p>
              <p class="text-gray-700 dark:text-gray-300 text-sm">
                {post.data.description}
              </p>
            </a>
          </article>
        ))}
      </div>
    </section>

    <section id="newsletter" class="w-full">
      <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-6">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
          Subscribe to the newsletter
        </h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
          Get emails from me about web development, tech, and early access to new articles.
        </p>
        <form class="flex flex-col sm:flex-row gap-2">
          <input
            type="email"
            placeholder="your@email.com"
            class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            required
          />
          <button
            type="submit"
            class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-black font-medium rounded-md transition-colors"
          >
            Subscribe
          </button>
        </form>
      </div>
    </section>
  </div>
</Layout>
